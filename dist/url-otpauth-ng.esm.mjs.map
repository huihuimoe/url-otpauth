{"version":3,"file":"url-otpauth-ng.esm.mjs","sources":["../src/ErrorType.js","../src/OtpauthInvalidURL.js","../src/parse.js","../index.js"],"sourcesContent":["/**\n * Enumeration of all error types raised by `OtpauthInvalidURL`.\n */\n\nexport const INVALID_ISSUER = 0\nexport const INVALID_LABEL = 1\nexport const INVALID_PROTOCOL = 2\nexport const MISSING_ACCOUNT_NAME = 3\nexport const MISSING_COUNTER = 4\nexport const MISSING_ISSUER = 5\nexport const MISSING_SECRET_KEY = 6\nexport const UNKNOWN_OTP = 7\nexport const INVALID_DIGITS = 8\nexport const UNKNOWN_ALGORITHM = 9\n","import * as ErrorType from './ErrorType'\n\n/**\n * Exception thrown whenever there's an error deconstructing an 'otpauth://' URI.\n *\n * You can query the `errorType` attribute to obtain the exact reason for failure. The\n * `errorType` attributes contains a value from the `ErrorType` enumeration.\n */\nclass OtpauthInvalidURL extends Error {\n    constructor(errorType) {\n        super()\n        this.name = 'OtpauthInvalidURL'\n        this.errorType = errorType\n        for (const type in ErrorType)\n            if (ErrorType[type] === errorType)\n                this.message =\n                    'Given otpauth:// URL is invalid. (Error ' + type + ')'\n    }\n}\n\nexport { OtpauthInvalidURL }\n","import * as ErrorType from './ErrorType'\nimport { OtpauthInvalidURL } from './OtpauthInvalidURL'\n\nconst _URL = typeof URL !== 'undefined' ? URL : require('url').URL\n\nconst PossibleDigits = [6, 8]\nconst PossibleAlgorithms = ['SHA1', 'SHA256', 'SHA512', 'MD5']\n\n/**\n * Parses an OTPAuth URI.\n *\n * Parses an URL as described in Google Authenticator's \"KeyUriFormat\" document (see:\n * [https://github.com/google/google-authenticator/wiki/Key-Uri-Format](https://github.com/google/google-authenticator/wiki/Key-Uri-Format))\n * and returns an object that contains the following properties:\n *\n * - `account`: The account name.\n * - `digits`: The number of digits of the resulting OTP. Default is 6 (six).\n * - `key`: The shared key in Base32 encoding.\n * - `issuer`: Provider or service this account is associated with. The default is the empty string.\n * - `type`: Either the string `hotp` or `totp`.\n *\n * OTP of type `hotp` have an additional `counter` field which contains the start value for the\n * HOTP counter. In all other cases this field is missing from the resulting object.\n *\n **/\nexport function parse(rawUrl) {\n    const decode = decodeURIComponent\n    const ret = {}\n\n    //\n    // Protocol\n    //\n    let parsed = new _URL(rawUrl)\n\n    if (parsed.protocol !== 'otpauth:') {\n        throw new OtpauthInvalidURL(ErrorType.INVALID_PROTOCOL)\n    }\n\n    // hack for Chrome\n    parsed.protocol = 'http'\n    parsed = new _URL(parsed)\n\n    //\n    // Type\n    //\n\n    const otpAlgo = decode(parsed.host)\n\n    if (otpAlgo !== 'hotp' && otpAlgo !== 'totp') {\n        throw new OtpauthInvalidURL(ErrorType.UNKNOWN_OTP)\n    }\n\n    ret.type = otpAlgo\n\n    //\n    // Label (contains account name, may contain issuer)\n    //\n\n    const label = parsed.pathname.substring(1)\n    // if you want to support mutli commas in label\n    // const labelComponents = label.split(~label.indexOf(':') ? /:(.*)/ : /%3A(.*)/, 2)\n    const labelComponents = label.split(~label.indexOf(':') ? ':' : '%3A')\n    let issuer = ''\n    let account = ''\n\n    if (labelComponents.length === 1) {\n        account = decode(labelComponents[0])\n    } else if (labelComponents.length === 2) {\n        issuer = decode(labelComponents[0])\n        account = decode(labelComponents[1])\n    } else {\n        throw new OtpauthInvalidURL(ErrorType.INVALID_LABEL)\n    }\n\n    if (account.length < 1) {\n        throw new OtpauthInvalidURL(ErrorType.MISSING_ACCOUNT_NAME)\n    }\n\n    if (labelComponents.length === 2 && issuer.length < 1) {\n        throw new OtpauthInvalidURL(ErrorType.INVALID_ISSUER)\n    }\n\n    ret.account = account\n\n    //\n    // Parameters\n    //\n\n    const parameters = parsed.searchParams\n\n    // Secret key\n    if (!parameters.has('secret')) {\n        throw new OtpauthInvalidURL(ErrorType.MISSING_SECRET_KEY)\n    }\n\n    ret.key = parameters.get('secret')\n\n    // Issuer\n    if (\n        parameters.has('issuer') &&\n        issuer &&\n        parameters.get('issuer') !== issuer\n    ) {\n        // If present, it must be equal to the \"issuer\" specified in the label.\n        throw new OtpauthInvalidURL(ErrorType.INVALID_ISSUER)\n    }\n\n    ret.issuer = parameters.get('issuer') || issuer\n\n    // OTP digits\n    ret.digits = 6 // Default is 6\n\n    if (parameters.has('digits')) {\n        const parsedDigits = parseInt(parameters.get('digits')) || 0\n        if (~PossibleDigits.indexOf(parsedDigits)) {\n            ret.digits = parsedDigits\n        } else {\n            throw new OtpauthInvalidURL(ErrorType.INVALID_DIGITS)\n        }\n    }\n\n    // Algorithm to create hash\n    if (parameters.has('algorithm')) {\n        if (~PossibleAlgorithms.indexOf(parameters.get('algorithm'))) {\n            // Optional 'algorithm' parameter.\n            ret.algorithm = parameters.get('algorithm')\n        } else {\n            throw new OtpauthInvalidURL(ErrorType.UNKNOWN_ALGORITHM)\n        }\n    }\n\n    // Period (only for TOTP)\n    if (otpAlgo === 'totp') {\n        // Optional 'period' parameter for TOTP.\n        if (parameters.has('period')) {\n            ret.period = parseFloat(parameters.get('period')) || 0\n        }\n    }\n\n    // Counter (only for HOTP)\n    if (otpAlgo === 'hotp') {\n        if (parameters.has('counter')) {\n            ret.counter = parseInt(parameters.get('counter')) || 0\n        } else {\n            // We require the 'counter' parameter for HOTP.\n            throw new OtpauthInvalidURL(ErrorType.MISSING_COUNTER)\n        }\n    }\n\n    return ret\n}\n","/*!\n * https://github.com/huihuimoe/url-otpauth-ng\n * Released under the MIT license\n */\n\nimport * as ErrorType from './src/ErrorType'\nimport { OtpauthInvalidURL } from './src/OtpauthInvalidURL'\nimport { parse } from './src/parse'\nexport { ErrorType, OtpauthInvalidURL, parse }\n"],"names":["ErrorType.INVALID_PROTOCOL","ErrorType.UNKNOWN_OTP","ErrorType.INVALID_LABEL","ErrorType.MISSING_ACCOUNT_NAME","ErrorType.INVALID_ISSUER","ErrorType.MISSING_SECRET_KEY","ErrorType.INVALID_DIGITS","ErrorType.UNKNOWN_ALGORITHM","ErrorType.MISSING_COUNTER"],"mappings":"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"}